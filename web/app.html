<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learn Words - Alpine.js</title>

    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <style>
      :root {
        --bg-color: #ffffff;
        --text-color: #333333;
        --row-bg: #ffffff;
        --header-bg: #f4f4f4;
        --border-color: #eeeeee;
        --accent-color: #4a90e2;
      }

      [data-theme="dark"] {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --row-bg: #1e1e1e;
        --header-bg: #2d2d2d;
        --border-color: #333333;
        --accent-color: #bb86fc;
      }

      body {
        font-family: "Segoe UI", system-ui, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 1rem;
        transition: background-color 0.3s;
      }

      .header-flex {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
        margin-bottom: 15px;
      }

      .controls {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        background: var(--header-bg);
        padding: 12px;
        border-radius: 8px;
        align-items: center;
      }

      select {
        padding: 8px;
        border-radius: 5px;
        background: var(--row-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        font-size: 0.9rem;
      }

      .swap-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 2rem;
        color: var(--accent-color);
      }

      .table-row {
        display: grid;
        text-align: center;
        justify-content: center;
        gap: 15px;
        padding: 12px;
        border-bottom: 1px solid var(--border-color);
        align-items: center;
        background-color: var(--row-bg);
      }
      .words-parent {
        text-align: center;
      }

      .word-src {
        color: var(--accent-color);
        font-weight: 600;
      }
      .word-target {
        font-weight: 400;
      }

      .delete-btn {
        width: 70px;
        appearance: none;
        border: none;
        background: linear-gradient(145deg, #ffffff, #f0f0f0);
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;

        /* Schatten fÃ¼r die "Klickbarkeit" (Tiefe) */
        box-shadow:
          2px 2px 5px #d1d1d1,
          -1px -1px 2px #ffffff;

        /* Sanfter Ãœbergang fÃ¼r das Feedback */
        transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);

        /* Verhindert den blauen Auswahlrahmen auf Smartphones */
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        touch-action: manipulation;
      }

      /* Der "GedrÃ¼ckt"-Effekt: Der Button senkt sich optisch ab */
      .delete-btn:active {
        background: #f8fafc;
        box-shadow:
          inset 2px 2px 5px #d1d1d1,
          inset -2px -2px 5px #ffffff;
        transform: translateY(1px);
      }

      /* Optionaler subtiler roter Schein beim Tippen */
      .delete-btn:active {
        color: #ef4444;
      }

      .status {
        text-align: center;
        padding: 10px;
        font-weight: bold;
      }

      .instructions {
        padding: 10px;
        font-style: italic;
        font-size: 0.9rem;
        opacity: 0.8;
      }
    </style>
  </head>
  <body x-data="vocabApp" :data-theme="theme">
    <div class="header-flex">
      <h2 style="margin: 0">Vocab Trainer</h2>
      <button
        @click="toggleTheme"
        style="
          background: none;
          border: 1px solid var(--border-color);
          color: var(--text-color);
          border-radius: 5px;
          padding: 5px 10px;
          cursor: pointer;
        "
      >
        ğŸŒ“
      </button>
    </div>

    <div class="controls">
      <select x-model="srcLang" @change="saveSettings">
        <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
        <option value="de">ğŸ‡©ğŸ‡ª German</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
        <option value="ro">ğŸ‡·ğŸ‡´ Romanian</option>
      </select>

      <button class="swap-btn" @click="swapLanguages">â‡„</button>

      <select x-model="targetLang" @change="saveSettings">
        <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
        <option value="de">ğŸ‡©ğŸ‡ª German</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
        <option value="ro">ğŸ‡·ğŸ‡´ Romanian</option>
      </select>

      <select x-model="levelFilter" @change="saveSettings">
        <option value="all">Alle Levels</option>
        <option value="1">Level 1</option>
        <option value="2">Level 2</option>
        <option value="3">Level 3</option>
        <option value="4">Level 4</option>
      </select>
    </div>

    <div class="instructions" x-text="instructions[targetLang] || '---'"></div>

    <div x-show="loading" class="status">Lade Daten von GitHub...</div>

    <div id="data-container">
      <template x-for="item in filteredWords" :key="item.id">
        <div class="table-row">
          <div class="word-src" x-text="item[srcLang] || '---'"></div>
          <div class="word-target" x-text="item[targetLang] || '---'"></div>
          <button class="delete-btn" @click="deleteEntry(item.id)">ğŸ—‘ï¸</button>
        </div>
      </template>

      <template x-if="filteredWords.length === 0 && !loading">
        <p
          style="text-align: center; color: #888"
          x-text="noEntries[targetLang]"
        ></p>
      </template>
    </div>

    <script>
      const JSON_URL =
        "https://raw.githubusercontent.com/GeorgeAndreasNechita/Learn-languages/refs/heads/main/web/words_test.json";

      document.addEventListener("alpine:init", () => {
        Alpine.data("vocabApp", () => ({
          db: null,
          words: [],
          loading: false,
          theme: localStorage.getItem("vocab-theme") || "dark",
          srcLang: localStorage.getItem("vocab-src") || "es",
          targetLang: localStorage.getItem("vocab-target") || "de",
          levelFilter: localStorage.getItem("vocab-level") || "all",

          instructions: {
            en: "These words are stored locally. If you delete browser data, they will be removed. The delete button removes a word from the database; once all words are deleted, the list will reset.",
            es: "Estas palabras se guardan localmente. Si borras los datos del navegador, se eliminarÃ¡n. El botÃ³n de borrar quita una palabra de la base de datos; cuando no quede ninguna, la lista se reiniciarÃ¡.",
            de: "Diese WÃ¶rter werden lokal gespeichert. Wenn Sie die Browserdaten lÃ¶schen, werden sie entfernt. Der LÃ¶sch-Button entfernt ein Wort aus der Datenbank; wenn alle WÃ¶rter gelÃ¶scht sind, wird die Liste zurÃ¼ckgesetzt.",
            it: "Queste parole sono memorizzate localmente. Se cancelli i dati del browser, verranno rimosse. Il pulsante elimina rimuove una parola dal database; quando tutte le parole saranno eliminate, l'elenco verrÃ  ripristinato.",
            ro: "Aceste cuvinte sunt stocate local. DacÄƒ È™tergeÈ›i datele browserului, acestea vor fi eliminate. Butonul de È™tergere eliminÄƒ un cuvÃ¢nt din baza de date; dupÄƒ ce toate cuvintele sunt È™terse, lista se va reseta.",
          },
          noEntries: {
            en: "No entries found for this filter.",
            es: "No se encontraron entradas para este filtro.",
            de: "Keine EintrÃ¤ge fÃ¼r diesen Filter.",
            it: "Nessuna voce trovata fÃ¼r questo filtro.",
            ro: "Nu s-au gÄƒsit intrÄƒri pentru acest filtru.",
          },

          async init() {
            // Dexie Init
            this.db = new Dexie("VocabularyDB");
            // await db.phrases.clear();
            this.db.version(1).stores({
              phrases: "++id, es, en, de, it, ro, level",
            });

            const count = await this.db.phrases.count();
            if (count === 0) {
              this.loading = true;
              try {
                const response = await fetch(JSON_URL);
                const data = await response.json();
                await this.db.phrases.bulkAdd(data);
              } catch (e) {
                console.error("Fehler beim Laden!", e);
              } finally {
                this.loading = false;
              }
            }
            this.loadFromDB();
          },

          async loadFromDB() {
            this.words = await this.db.phrases.toArray();
          },

          get filteredWords() {
            if (this.levelFilter === "all") return this.words;
            return this.words.filter(
              (w) => String(w.level) === this.levelFilter,
            );
          },

          saveSettings() {
            localStorage.setItem("vocab-src", this.srcLang);
            localStorage.setItem("vocab-target", this.targetLang);
            localStorage.setItem("vocab-level", this.levelFilter);
          },

          swapLanguages() {
            [this.srcLang, this.targetLang] = [this.targetLang, this.srcLang];
            this.saveSettings();
          },

          async deleteEntry(id) {
            await this.db.phrases.delete(id);
            await this.loadFromDB();
            // Wenn alles leer ist, neu laden (wie in deinem Original-Konzept angedeutet)
            if (this.words.length === 0) {
              this.init();
            }
          },

          toggleTheme() {
            this.theme = this.theme === "dark" ? "light" : "dark";
            localStorage.setItem("vocab-theme", this.theme);
          },
        }));
      });
    </script>
  </body>
</html>
