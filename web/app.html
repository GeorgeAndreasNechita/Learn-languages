<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learn Words - Adaptive</title>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <style>
      :root {
        --bg-color: #ffffff;
        --text-color: #333333;
        --row-bg: #ffffff;
        --header-bg: #f4f4f4;
        --border-color: #eeeeee;
        --accent-color: #4a90e2;
      }

      [data-theme="dark"] {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --row-bg: #1e1e1e;
        --header-bg: #2d2d2d;
        --border-color: #333333;
        --accent-color: #bb86fc;
      }

      body {
        font-family: "Segoe UI", system-ui, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 1rem;
        transition: background-color 0.3s;
      }

      .header-flex {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
        margin-bottom: 15px;
      }

      .controls {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        background: var(--header-bg);
        padding: 12px;
        border-radius: 8px;
        align-items: center;
      }

      select {
        padding: 8px;
        border-radius: 5px;
        background: var(--row-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        font-size: 0.9rem;
      }

      .swap-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 2rem;
        color: var(--accent-color);
      }

      .table-row {
        display: grid;
        grid-template-columns: 1fr min-content;
        gap: 15px;
        padding: 12px;
        border-bottom: 1px solid var(--border-color);
        align-items: center;
        background-color: var(--row-bg);
      }
      .words-parent {
        text-align: center;
      }

      .word-src {
        color: var(--accent-color);
        font-weight: 600;
      }
      .word-target {
        font-weight: 400;
      }

      .delete-btn {
        cursor: pointer;
        background: none;
        border: none;
        font-size: 1.7rem;
        color: #ff4d4d;
        opacity: 0.6;
      }
      .delete-btn:hover {
        opacity: 1;
      }

      .status {
        text-align: center;
        padding: 10px;
        font-weight: bold;
      }
    </style>
  </head>
  <body data-theme="dark">
    <div class="header-flex">
      <h2 style="margin: 0">Vocab Trainer</h2>
      <button
        id="theme-toggle"
        onclick="toggleTheme()"
        style="
          background: none;
          border: 1px solid var(--border-color);
          color: var(--text-color);
          border-radius: 5px;
          padding: 5px 10px;
          cursor: pointer;
        "
      >
        ğŸŒ“
      </button>
    </div>

    <div class="controls">
      <select id="select-src" onchange="saveSettings()">
        <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
        <option value="de">ğŸ‡©ğŸ‡ª German</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
        <option value="ro">ğŸ‡·ğŸ‡´ Romanian</option>
      </select>

      <button class="swap-btn" onclick="swapLanguages()">â‡„</button>

      <select id="select-target" onchange="saveSettings()">
        <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
        <option value="de">ğŸ‡©ğŸ‡ª German</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
        <option value="ro">ğŸ‡·ğŸ‡´ Romanian</option>
      </select>

      <select id="select-level" onchange="saveSettings()">
        <option value="all">Alle Levels</option>
        <option value="1">Lvl 1</option>
        <option value="2">Lvl 2</option>
        <option value="3">Coming soon...</option>
      </select>
    </div>

    <div id="instructions-message" class="instructions">
      ${INSTRUCTIONS[targetLang] || "---"}
    </div>
    <div id="status-message" class="status"></div>
    <div id="data-container"></div>

    <script>
      // Datenbank initialisieren
      const db = new Dexie("VocabularyDB");
      db.version(1).stores({
        phrases: "++id, es, en, de, it, ro, level",
      });

      const JSON_URL =
        "https://raw.githubusercontent.com/GeorgeAndreasNechita/Learn-languages/refs/heads/main/web/words-final.json";

      const INSTRUCTIONS = {
        en: "These words are stored locally. If you delete browser data, they will be removed. The delete button removes a word from the database; once all words are deleted, the list will reset.",
        es: "Estas palabras se guardan localmente. Si borras los datos del navegador, se eliminarÃ¡n. El botÃ³n de borrar quita una palabra de la base de datos; cuando no quede ninguna, la lista se reiniciarÃ¡.",
        de: "Diese WÃ¶rter werden lokal gespeichert. Wenn Sie die Browserdaten lÃ¶schen, werden sie entfernt. Der LÃ¶sch-Button entfernt ein Wort aus der Datenbank; wenn alle WÃ¶rter gelÃ¶scht sind, wird die Liste zurÃ¼ckgesetzt.",
        it: "Queste parole sono memorizzate localmente. Se cancelli i dati del browser, verranno rimosse. Il pulsante elimina rimuove una parola dal database; quando tutte le parole saranno eliminate, l'elenco verrÃ  ripristinato.",
        ro: "Aceste cuvinte sunt stocate local. DacÄƒ È™tergeÈ›i datele browserului, acestea vor fi eliminate. Butonul de È™tergere eliminÄƒ un cuvÃ¢nt din baza de date; dupÄƒ ce toate cuvintele sunt È™terse, lista se va reseta.",
      };
      // 1. Einstellungen laden und speichern
      function loadSettings() {
        document.getElementById("select-src").value =
          localStorage.getItem("vocab-src") || "es";
        document.getElementById("select-target").value =
          localStorage.getItem("vocab-target") || "de";
        document.getElementById("select-level").value =
          localStorage.getItem("vocab-level") || "all";
      }

      function saveSettings() {
        localStorage.setItem(
          "vocab-src",
          document.getElementById("select-src").value,
        );
        localStorage.setItem(
          "vocab-target",
          document.getElementById("select-target").value,
        );
        localStorage.setItem(
          "vocab-level",
          document.getElementById("select-level").value,
        );
        renderData();
      }

      function swapLanguages() {
        const src = document.getElementById("select-src");
        const target = document.getElementById("select-target");
        const temp = src.value;
        src.value = target.value;
        target.value = temp;
        saveSettings();
      }

      // 2. Datenbank-Initialisierung
      async function initApp() {
        loadSettings();
        const count = await db.phrases.count();
        if (count === 0) {
          document.getElementById("status-message").innerHTML =
            "Lade Daten von GitHub...";
          try {
            const response = await fetch(JSON_URL);
            const data = await response.json();
            await db.phrases.bulkAdd(data);
            document.getElementById("status-message").innerHTML = "";
          } catch (e) {
            document.getElementById("status-message").innerHTML =
              "Fehler beim Laden!";
          }
        }
        renderData();
      }

      // 3. Anzeige-Logik
      async function renderData() {
        const srcLang = document.getElementById("select-src").value;
        const targetLang = document.getElementById("select-target").value;
        const levelFilter = document.getElementById("select-level").value;
        const instructionsElem = document.getElementById(
          "instructions-message",
        );
        if (instructionsElem) {
          instructionsElem.textContent = INSTRUCTIONS[targetLang] || "---";
        }
        const container = document.getElementById("data-container");

        let words = await db.phrases.toArray();

        if (levelFilter !== "all") {
          words = words.filter((w) => String(w.level) === levelFilter);
        }
        if (words.length === 0) {
          container.innerHTML =
            '<p style="text-align:center; color: #888;">Keine EintrÃ¤ge fÃ¼r diesen Filter.</p>';
          return;
        }

        container.innerHTML = words
          .map(
            (item) => `
          <div class="table-row">
            <div class="words-parent">
              <div class="word-src">${item[srcLang] || "---"}</div>
              <div class="word-target">${item[targetLang] || "---"}</div>
            </div>
            <button class="delete-btn" onclick="deleteEntry(${item.id})">ğŸ—‘ï¸</button>
          </div>
        `,
          )
          .join("");
      }

      async function deleteEntry(id) {
        await db.phrases.delete(id);
        renderData();
      }

      function toggleTheme() {
        const body = document.body;
        body.setAttribute(
          "data-theme",
          body.getAttribute("data-theme") === "dark" ? "light" : "dark",
        );
      }

      initApp();
    </script>
  </body>
</html>
